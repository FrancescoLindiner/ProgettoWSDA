<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palinsesto LED Wall</title>
    <link rel="stylesheet" href="../css/css_impianti.css">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>
<body>
<div id="content"></div>
<div id="info-bar">
    <span id="city"></span>
    <span id="datetime"></span>
    <span id="time"></span>
    <span id="sunrise"></span>
    <span id="sunset"></span>
    <span id="weather"></span>
</div>
<script src="../javascript/javascript_impianti.js"></script>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const idImpianto = urlParams.get('id');

    function segnala_stato(stato) {
        $.get("/segnala_stato", { id: idImpianto, stato: stato })
            .done(function(response) {
                console.log("Stato segnalato: " + stato);
            })
            .fail(function() {
                console.error("Errore nella segnalazione dello stato: " + stato);
            });
    }

    // Segnala quando l'impianto è attivo
    window.addEventListener('load', function() {
        console.log("ATTIVO")
        segnala_stato(true);
    });

    // Segnala quando l'impianto è disattivato
    window.addEventListener('beforeunload', function() {
        console.log("DISATTIVATO")
        segnala_stato(false);
    });


    $.get("/wsda", { id: idImpianto })
        .done(function(data) { // data contiene la vista restituita

            $('#content').html(data); // Aggiorna il contenuto della pagina con la vista restituita
        })
        .fail(function() {
            console.error("Error loading ID.");
        });
</script>
</body>
</html>
